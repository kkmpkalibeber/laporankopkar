<!doctype html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Laporan Tutup Buku - KOPKAR ATTA'AWUN</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;family=Playfair+Display:wght@700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
    }
    .font-display {
      font-family: 'Playfair Display', serif;
    }
    .gradient-primary {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }
    .gradient-success {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
    }
    .stat-card {
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }
    .btn-primary {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover, .btn-primary:active {
      background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 15px rgba(37, 99, 235, 0.4);
    }
    .btn-success {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }
    .btn-success:hover, .btn-success:active {
      background: linear-gradient(135deg, #047857 0%, #065f46 100%);
      box-shadow: 0 6px 15px rgba(5, 150, 105, 0.4);
    }
    .data-table th {
      background: #0f172a;
      color: white;
    }
    .data-table tr:nth-child(even) {
      background: #f8fafc;
    }
    .data-table tr:hover {
      background: #dbeafe;
    }
    .toast {
      animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1), fadeOut 0.4s ease 2.6s forwards;
    }
    @keyframes slideIn {
      from { transform: translateX(120%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; pointer-events: none; }
    }
    .login-bg {
      background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #1e293b 100%);
    }
    .floating {
      animation: float 6s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .modal-backdrop {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(8px);
    }
    .print-section {
      background: white;
      color: #1f2937;
    }
    .print-preview-modal {
      background: rgba(15, 23, 42, 0.98);
      backdrop-filter: blur(10px);
    }
    .print-preview-content {
      width: 90%;
      max-width: 210mm;
      min-height: 297mm;
      background: white;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      overflow: hidden;
    }
    
    /* Mobile Optimizations */
    @media (max-width: 768px) {
      .stat-card {
        padding: 1rem !important;
      }
      .glass-card {
        padding: 1.5rem !important;
        border-radius: 1rem !important;
      }
      .btn-primary, .btn-success {
        padding: 0.75rem 1rem !important;
        font-size: 0.9rem !important;
      }
      .data-table {
        font-size: 0.8rem;
      }
      .data-table th, .data-table td {
        padding: 0.75rem 0.5rem !important;
      }
      .print-preview-content {
        width: 95%;
        min-height: auto;
        max-height: 80vh;
        overflow-y: auto;
      }
    }
    
    @media (max-width: 480px) {
      .grid-cols-1 {
        grid-template-columns: 1fr !important;
      }
      .grid-cols-2 {
        grid-template-columns: repeat(2, 1fr) !important;
      }
      .text-2xl {
        font-size: 1.5rem !important;
      }
      .text-3xl {
        font-size: 1.75rem !important;
      }
      .text-4xl {
        font-size: 2rem !important;
      }
    }
    
    /* Touch-friendly buttons */
    button, [role="button"], input[type="submit"] {
      min-height: 44px;
      min-width: 44px;
    }
    
    input, select, textarea {
      font-size: 16px !important; /* Prevent zoom on iOS */
    }
    
    /* Print Styles */
    @media print {
      body * {
        visibility: hidden;
      }
      #print-preview-container, #print-preview-container * {
        visibility: visible;
      }
      #print-preview-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        box-shadow: none;
        border-radius: 0;
        margin: 0;
        padding: 0;
      }
      .no-print {
        display: none !important;
      }
      @page {
        size: A4;
        margin: 15mm;
      }
    }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
  </style>
</head>
<body class="h-full">
  <div id="app" class="h-full overflow-auto">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-xs"></div>
    
    <!-- Login Screen -->
    <div id="login-screen" class="login-bg h-full flex items-center justify-center p-4">
      <div class="w-full max-w-md">
        <div class="text-center mb-8 floating">
          <div class="w-20 h-20 bg-gradient-success rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-xl">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h1 id="login-org-name" class="text-3xl font-display font-bold text-white mb-2">KOPKAR ATTA'AWUN</h1>
          <p id="login-report-title" class="text-emerald-300 text-base font-medium">Laporan Tutup Buku Th. 2025</p>
        </div>
        
        <div class="glass-card rounded-2xl shadow-xl p-6">
          <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">Selamat Datang</h2>
          <form id="login-form" onsubmit="handleLogin(event)">
            <div class="mb-4">
              <label for="user-type" class="block text-sm font-semibold text-gray-700 mb-1">Masuk Sebagai</label>
              <select id="user-type" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-700 font-medium appearance-none">
                <option value="admin">Administrator</option>
                <option value="member">Anggota Koperasi</option>
              </select>
            </div>
            
            <div class="mb-4">
              <label for="password" class="block text-sm font-semibold text-gray-700 mb-1">Password</label>
              <div class="relative">
                <input type="password" id="password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all text-gray-700 font-medium" placeholder="Masukkan password" required>
                <button type="button" onclick="togglePassword()" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1">
                  <svg id="eye-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
              <p class="text-blue-800 text-xs font-medium">üîê <span class="font-bold">Password Anggota:</span> kopkarjaya</p>
            </div>
            
            <button type="submit" class="btn-primary w-full px-4 py-3 text-white rounded-lg font-bold shadow-lg active:scale-95 transition-transform">
              Masuk
            </button>
          </form>
        </div>
        
        <p class="text-center text-white/70 text-xs mt-4">¬© 2025 KOPKAR ATTA'AWUN. All rights reserved.</p>
      </div>
    </div>
    
    <!-- Main Application -->
    <div id="main-app" class="hidden h-full gradient-primary">
      <!-- Header -->
      <header class="bg-white/10 backdrop-blur-xl border-b border-white/20 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 py-3">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-success rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <div>
                <h1 id="header-title" class="text-lg font-display font-bold text-white truncate">Laporan Tutup Buku Th. 2025</h1>
                <p id="header-org" class="text-emerald-300 text-xs font-semibold truncate">KOPKAR ATTA'AWUN</p>
              </div>
            </div>
            
            <div class="flex items-center gap-2">
              <div class="text-right hidden sm:block">
                <p class="text-white/70 text-xs font-medium">Masuk sebagai</p>
                <p id="user-badge" class="text-white font-bold text-sm"></p>
              </div>
              <button onclick="logout()" class="px-3 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg font-semibold transition-all flex items-center gap-1 active:scale-95">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                <span class="hidden sm:inline">Keluar</span>
              </button>
            </div>
          </div>
        </div>
      </header>
      
      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 py-4">
        <!-- Admin Panel -->
        <div id="admin-panel" class="hidden">
          <div class="glass-card rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-800">Sumber Data</h2>
                <p class="text-gray-500 text-sm font-medium">Data diambil langsung dari Google Sheets</p>
              </div>
            </div>
            
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-xl p-4 mb-4">
              <p class="text-blue-900 font-semibold text-sm mb-2">üìä Google Sheets URL:</p>
              <code class="text-xs text-blue-800 bg-white/70 px-2 py-1 rounded block font-mono break-all">
                https://docs.google.com/spreadsheets/d/e/2PACX-1vTgF6TOXUEU5lkes0myZTiEnI1LhmWx_kD73RordpVoviaHsO_ih58oPJz6IJnFxdOoMgaE0ncoch_-/pub?gid=0&single=true&output=csv
              </code>
              <p class="text-blue-700 text-xs mt-2">‚úÖ Data diperbarui otomatis setiap 5 menit</p>
              <p class="text-blue-800 text-xs mt-1 font-semibold">üîÑ Klik Refresh untuk memperbarui data sekarang</p>
            </div>
            
            <div class="flex flex-wrap gap-3">
              <button onclick="refreshData()" class="btn-primary px-4 py-3 text-white rounded-lg font-bold shadow-lg flex items-center gap-2 active:scale-95">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Refresh Data
              </button>
            </div>
          </div>
          
          <!-- Data Table -->
          <div class="glass-card rounded-2xl shadow-xl p-6">
            <div class="flex items-center justify-between mb-6">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-emerald-100 rounded-xl flex items-center justify-center">
                  <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                </div>
                <div>
                  <h2 class="text-xl font-bold text-gray-800">Data Anggota</h2>
                  <p id="admin-count" class="text-gray-500 text-sm font-medium">0 data terdaftar</p>
                </div>
              </div>
            </div>
            
            <div class="overflow-x-auto rounded-xl border-2 border-gray-200">
              <table class="data-table w-full text-sm">
                <thead>
                  <tr>
                    <th class="px-3 py-3 text-left font-bold text-xs">ID Anggota</th>
                    <th class="px-3 py-3 text-left font-bold text-xs">Nama</th>
                    <th class="px-3 py-3 text-right font-bold text-xs">Simpanan</th>
                    <th class="px-3 py-3 text-right font-bold text-xs">SHU Diterima</th>
                    <th class="px-3 py-3 text-center font-bold text-xs">Aksi</th>
                  </tr>
                </thead>
                <tbody id="admin-table-body">
                  <tr>
                    <td colspan="5" class="px-3 py-12 text-center text-gray-400">
                      <div class="flex flex-col items-center gap-2">
                        <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <span class="font-medium text-sm">Tidak ada data. Klik Refresh untuk mengambil data.</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Member Panel -->
        <div id="member-panel" class="hidden">
          <!-- Summary Statistics -->
          <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6">
            <div class="stat-card rounded-xl p-4 shadow border border-gray-100">
              <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </div>
              </div>
              <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Total Anggota</p>
              <p id="stat-members" class="text-xl font-bold text-gray-800">0</p>
            </div>
            
            <div class="stat-card rounded-xl p-4 shadow border border-gray-100">
              <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                  </svg>
                </div>
              </div>
              <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Total Asset</p>
              <p id="stat-asset" class="text-lg font-bold text-emerald-600">Rp 0</p>
            </div>
            
            <div class="stat-card rounded-xl p-4 shadow border border-gray-100 hidden sm:block">
              <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-cyan-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                </div>
              </div>
              <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Total Pendapatan</p>
              <p id="stat-income" class="text-lg font-bold text-cyan-600">Rp 0</p>
            </div>
            
            <div class="stat-card rounded-xl p-4 shadow border border-gray-100 hidden sm:block">
              <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                  <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" />
                  </svg>
                </div>
              </div>
              <p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Total Beban</p>
              <p id="stat-expense" class="text-lg font-bold text-red-600">Rp 0</p>
            </div>
            
            <div class="stat-card rounded-xl p-4 shadow border border-gray-100 bg-gradient-to-br from-emerald-50 to-white col-span-2 sm:col-span-1">
              <div class="flex items-center gap-2 mb-3">
                <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center shadow">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
              <p class="text-gray-600 text-xs font-bold uppercase tracking-wider mb-1">SHU Th 2025</p>
              <p id="stat-shu" class="text-lg font-bold text-emerald-700">Rp 0</p>
            </div>
          </div>
          
          <!-- Search Section -->
          <div class="glass-card rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>
              <div>
                <h2 class="text-xl font-bold text-gray-800">Pencarian Data Anggota</h2>
                <p class="text-gray-500 text-sm font-medium">Cari berdasarkan nama anggota</p>
              </div>
            </div>
            
            <div class="relative">
              <input type="text" id="search-input" onkeyup="searchMember()" class="w-full px-4 py-3 pl-12 border-2 border-gray-300 rounded-lg text-gray-700 font-medium focus:border-purple-500 focus:ring-2 focus:ring-purple-100 transition-all" placeholder="Ketik nama anggota...">
              <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </div>
            </div>
            
            <div id="search-results" class="mt-4 space-y-2 max-h-64 overflow-y-auto"></div>
          </div>
          
          <!-- Member Detail -->
          <div id="member-detail" class="hidden"></div>
        </div>
      </main>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 z-50 hidden">
      <div class="modal-backdrop absolute inset-0" onclick="closeModal()"></div>
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm mx-4">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-800 mb-2">Konfirmasi</h3>
          <p id="confirm-message" class="text-gray-600 mb-6"></p>
          <div class="flex gap-3 justify-center">
            <button onclick="closeModal()" class="px-6 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-bold transition-all active:scale-95">
              Batal
            </button>
            <button id="confirm-btn" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold transition-all shadow active:scale-95">
              Hapus
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Print Preview Modal -->
    <div id="print-preview-modal" class="fixed inset-0 z-50 hidden print-preview-modal overflow-auto">
      <div class="min-h-screen py-4 px-2">
        <div class="max-w-5xl mx-auto">
          <div class="flex justify-between items-center mb-4 no-print">
            <h2 class="text-xl font-bold text-white">Preview Cetak</h2>
            <div class="flex gap-2">
              <button onclick="executePrint()" class="btn-success px-4 py-2 text-white rounded-lg font-bold shadow flex items-center gap-2 active:scale-95">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                </svg>
                Cetak
              </button>
              <button onclick="closePrintPreview()" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition-all active:scale-95">
                Tutup
              </button>
            </div>
          </div>
          <div id="print-preview-container" class="print-preview-content mx-auto">
            <!-- Print content will be inserted here -->
          </div>
          <div class="text-center mt-4 no-print">
            <p class="text-white/70 text-xs">Gunakan menu cetak browser untuk mencetak</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 z-50 hidden bg-gradient-to-br from-slate-900/90 to-blue-900/90 backdrop-blur-sm flex items-center justify-center">
      <div class="bg-white rounded-2xl p-8 flex flex-col items-center gap-4 shadow-xl mx-4">
        <div class="w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin"></div>
        <p id="loading-text" class="text-gray-700 font-bold">Memproses...</p>
      </div>
    </div>
  </div>
  
  <script>
    // State
    let allMembers = [];
    let currentUser = null;
    let config = {};

    const defaultConfig = {
      report_title: 'Laporan Tutup Buku Th. 2025',
      organization_name: 'KOPKAR ATTA\'AWUN',
      year_period: '2025',
      total_asset: 'Rp. 1.207.995.657',
      total_income: 'Rp. 171.080.552',
      total_expense: 'Rp. 59.470.945',
      shu_2025: 'Rp. 111.609.607',
      primary_color: '#0f172a',
      secondary_color: '#059669',
      accent_color: '#2563eb',
      text_color: '#1f2937',
      background_color: '#f8fafc',
      font_family: 'Inter'
    };

    // Google Sheets URL
    const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgF6TOXUEU5lkes0myZTiEnI1LhmWx_kD73RordpVoviaHsO_ih58oPJz6IJnFxdOoMgaE0ncoch_-/pub?gid=0&single=true&output=csv';

    // Function to fetch data from Google Sheets
    async function fetchDataFromGoogleSheets() {
      showLoading('Mengambil data dari Google Sheets...');
      
      try {
        const response = await fetch(GOOGLE_SHEETS_URL);
        const csvText = await response.text();
        
        // Parse CSV
        const rows = csvText.split('\n');
        const headers = rows[0].split(',').map(h => h.trim().toLowerCase());
        
        // Map headers to match your field names
        const headerMap = {
          'id ang': 'id_anggota',
          'nama': 'nama',
          'simpanan': 'simpanan',
          'piutang': 'piutang',
          'ss': 'ss',
          'tab harian': 'tab_harian',
          'shr': 'shr',
          'shu diterima': 'shu_diterima'
        };
        
        const members = [];
        
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i];
          if (!row.trim()) continue;
          
          const values = row.split(',').map(v => v.trim());
          const member = {
            record_type: 'member',
            __backendId: `member_${i}` // Generate unique ID
          };
          
          // Map values to fields
          headers.forEach((header, index) => {
            const mappedField = headerMap[header];
            if (mappedField && values[index]) {
              member[mappedField] = values[index];
            }
          });
          
          // Skip if missing essential fields
          if (member.id_anggota && member.nama) {
            members.push(member);
          }
        }
        
        allMembers = members;
        updateUI();
        hideLoading();
        
        if (members.length > 0) {
          showToast(`Berhasil mengambil ${members.length} data dari Google Sheets`, 'success');
        } else {
          showToast('Tidak ada data ditemukan di Google Sheets', 'warning');
        }
        
      } catch (error) {
        hideLoading();
        console.error('Error fetching data:', error);
        showToast('Gagal mengambil data dari Google Sheets', 'error');
      }
    }

    // Initialize
    async function init() {
      config = { ...defaultConfig };

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              { get: () => cfg.primary_color || defaultConfig.primary_color, set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }},
              { get: () => cfg.secondary_color || defaultConfig.secondary_color, set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); }},
              { get: () => cfg.accent_color || defaultConfig.accent_color, set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }},
              { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }},
              { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }}
            ],
            borderables: [],
            fontEditable: {
              get: () => cfg.font_family || defaultConfig.font_family,
              set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
            },
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['report_title', cfg.report_title || defaultConfig.report_title],
            ['organization_name', cfg.organization_name || defaultConfig.organization_name],
            ['year_period', cfg.year_period || defaultConfig.year_period],
            ['total_asset', cfg.total_asset || defaultConfig.total_asset],
            ['total_income', cfg.total_income || defaultConfig.total_income],
            ['total_expense', cfg.total_expense || defaultConfig.total_expense],
            ['shu_2025', cfg.shu_2025 || defaultConfig.shu_2025]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }

      applyConfig();
      
      // Fetch data from Google Sheets
      await fetchDataFromGoogleSheets();
    }

    function applyConfig() {
      const title = config.report_title || defaultConfig.report_title;
      const org = config.organization_name || defaultConfig.organization_name;
      const font = config.font_family || defaultConfig.font_family;

      const titleElements = document.querySelectorAll('#header-title, #login-report-title');
      titleElements.forEach(el => el.textContent = title);

      const orgElements = document.querySelectorAll('#header-org, #login-org-name');
      orgElements.forEach(el => el.textContent = org);

      document.body.style.fontFamily = `${font}, 'Inter', sans-serif`;
    }

    function handleLogin(event) {
      event.preventDefault();
      
      const userType = document.getElementById('user-type').value;
      const password = document.getElementById('password').value;

      const credentials = {
        'admin': 'f4150l',
        'member': 'kopkarjaya'
      };

      if (password.toLowerCase() !== credentials[userType].toLowerCase()) {
        showToast('Password salah! Silakan coba lagi.', 'error');
        return;
      }

      currentUser = userType;
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');

      if (userType === 'admin') {
        document.getElementById('admin-panel').classList.remove('hidden');
        document.getElementById('member-panel').classList.add('hidden');
        document.getElementById('user-badge').textContent = 'Administrator';
      } else {
        document.getElementById('admin-panel').classList.add('hidden');
        document.getElementById('member-panel').classList.remove('hidden');
        document.getElementById('user-badge').textContent = 'Anggota Koperasi';
      }

      showToast(`Selamat datang, ${userType === 'admin' ? 'Administrator' : 'Anggota'}!`, 'success');
      updateUI();
    }

    function togglePassword() {
      const input = document.getElementById('password');
      const icon = document.getElementById('eye-icon');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>';
      } else {
        input.type = 'password';
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>';
      }
    }

    function logout() {
      currentUser = null;
      document.getElementById('main-app').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('password').value = '';
      document.getElementById('member-detail').classList.add('hidden');
      document.getElementById('search-input').value = '';
      showToast('Anda telah keluar', 'info');
    }

    async function refreshData() {
      await fetchDataFromGoogleSheets();
    }

    function updateUI() {
      if (currentUser === 'admin') {
        updateAdminTable();
      } else {
        updateMemberStats();
      }
    }

    function updateMemberStats() {
      const totalMembers = allMembers.length;

      document.getElementById('stat-members').textContent = totalMembers.toLocaleString('id-ID');
      document.getElementById('stat-asset').textContent = config.total_asset || defaultConfig.total_asset;
      document.getElementById('stat-income').textContent = config.total_income || defaultConfig.total_income;
      document.getElementById('stat-expense').textContent = config.total_expense || defaultConfig.total_expense;
      document.getElementById('stat-shu').textContent = config.shu_2025 || defaultConfig.shu_2025;
    }

    function updateAdminTable() {
      const tbody = document.getElementById('admin-table-body');
      const count = document.getElementById('admin-count');

      count.textContent = `${allMembers.length} data terdaftar`;

      if (allMembers.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-3 py-12 text-center text-gray-400">
              <div class="flex flex-col items-center gap-2">
                <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <span class="font-medium text-sm">Tidak ada data. Klik Refresh untuk mengambil data.</span>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = allMembers.map(m => `
        <tr class="border-b border-gray-100">
          <td class="px-3 py-3 text-gray-700 font-medium text-xs">${m.id_anggota}</td>
          <td class="px-3 py-3 text-gray-800 font-semibold text-sm">${m.nama}</td>
          <td class="px-3 py-3 text-right text-gray-700 text-sm">${m.simpanan || '0'}</td>
          <td class="px-3 py-3 text-right font-semibold text-emerald-600 text-sm">${m.shu_diterima || '0'}</td>
          <td class="px-3 py-3 text-center">
            <button onclick="showToast('Data diambil dari Google Sheets', 'info')" class="p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-all active:scale-95" title="Edit di Google Sheets">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
              </svg>
            </button>
          </td>
        </tr>
      `).join('');
    }

    function searchMember() {
      const query = document.getElementById('search-input').value.toLowerCase().trim();
      const resultsContainer = document.getElementById('search-results');

      if (!query) {
        resultsContainer.innerHTML = '';
        return;
      }

      const filtered = allMembers.filter(m => 
        m.nama.toLowerCase().includes(query)
      );

      if (filtered.length === 0) {
        resultsContainer.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p class="font-medium text-sm">Tidak ada hasil untuk "${query}"</p>
          </div>
        `;
        return;
      }

      resultsContainer.innerHTML = filtered.map(m => `
        <button onclick="showMemberDetail('${m.__backendId}')" class="w-full bg-white hover:bg-blue-50 border border-gray-200 hover:border-blue-400 rounded-lg p-4 transition-all text-left group active:scale-[0.98]">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-lg flex items-center justify-center shadow">
                <span class="text-white font-bold">${m.nama.charAt(0).toUpperCase()}</span>
              </div>
              <div>
                <p class="font-bold text-gray-800 group-hover:text-blue-600 text-sm">${m.nama}</p>
                <p class="text-gray-500 text-xs">ID: ${m.id_anggota}</p>
              </div>
            </div>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </div>
        </button>
      `).join('');
    }

    function showMemberDetail(id) {
      const member = allMembers.find(m => m.__backendId === id);
      if (!member) return;

      const detailContainer = document.getElementById('member-detail');
      
      detailContainer.innerHTML = `
        <div class="glass-card rounded-2xl shadow-xl overflow-hidden print-section">
          <div class="bg-gradient-to-r from-emerald-600 to-emerald-700 px-4 py-6 no-print">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4">
              <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                  <span class="text-2xl font-bold text-white">${member.nama.charAt(0).toUpperCase()}</span>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-white mb-1">${member.nama}</h3>
                  <p class="text-emerald-100 text-sm">ID Anggota: ${member.id_anggota}</p>
                </div>
              </div>
              <button onclick="printPreview()" class="btn-success px-4 py-3 text-white rounded-lg font-bold shadow flex items-center gap-2 active:scale-95 self-start">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                </svg>
                Cetak Laporan
              </button>
            </div>
          </div>

          <div class="hidden print:block px-4 py-4 border-b-4 border-emerald-600">
            <div class="text-center">
              <h1 class="text-2xl font-display font-bold text-gray-800 mb-1">${config.organization_name || defaultConfig.organization_name}</h1>
              <p class="text-lg text-gray-600 font-semibold mb-1">${config.report_title || defaultConfig.report_title}</p>
              <p class="text-gray-500 text-sm">Tahun ${config.year_period || defaultConfig.year_period}</p>
            </div>
          </div>

          <div class="hidden print:block px-4 py-4 bg-gray-50 border-b-2 border-gray-200">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <p class="text-xs text-gray-500 font-medium">Nama Anggota:</p>
                <p class="text-base font-bold text-gray-800">${member.nama}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 font-medium">ID Anggota:</p>
                <p class="text-base font-bold text-gray-800">${member.id_anggota}</p>
              </div>
            </div>
          </div>

          <div class="p-4">
            <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Rincian Simpanan & Tabungan</h4>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">
              <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
                <p class="text-blue-700 text-xs font-bold mb-1">Simpanan</p>
                <p class="text-lg font-bold text-blue-900">${member.simpanan || '0'}</p>
              </div>
              <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200">
                <p class="text-orange-700 text-xs font-bold mb-1">Piutang</p>
                <p class="text-lg font-bold text-orange-900">${member.piutang || '0'}</p>
              </div>
              <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                <p class="text-purple-700 text-xs font-bold mb-1">SS</p>
                <p class="text-lg font-bold text-purple-900">${member.ss || '0'}</p>
              </div>
              <div class="bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-lg p-4 border border-cyan-200">
                <p class="text-cyan-700 text-xs font-bold mb-1">Tabungan Harian</p>
                <p class="text-lg font-bold text-cyan-900">${member.tab_harian || '0'}</p>
              </div>
            </div>

            <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Pendapatan & Bagi Hasil</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
              <div class="bg-gradient-to-br from-teal-50 to-teal-100 rounded-lg p-5 border border-teal-200">
                <p class="text-teal-700 text-xs font-bold mb-2">SHR</p>
                <p class="text-xl font-bold text-teal-900">${member.shr || '0'}</p>
              </div>
              <div class="bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-lg p-5 border-2 border-emerald-400 shadow">
                <p class="text-emerald-800 text-xs font-bold mb-2">SHU Diterima</p>
                <p class="text-2xl font-bold text-emerald-900">${member.shu_diterima || '0'}</p>
              </div>
            </div>

            <div class="hidden print:block mt-6 mb-6 p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border-2 border-blue-300">
              <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                KESIMPULAN
              </h4>
              <p class="text-gray-700 font-medium mb-3 text-sm">Koperasi ini menunjukkan kinerja keuangan yang sangat sehat dan kuat dengan:</p>
              <ol class="space-y-2 text-gray-700 text-sm">
                <li class="flex gap-2">
                  <span class="font-bold text-blue-600 flex-shrink-0">1.</span>
                  <span>Profitabilitas tinggi (Margin SHU 65,24%, ROE 18,27%)</span>
                </li>
                <li class="flex gap-2">
                  <span class="font-bold text-blue-600 flex-shrink-0">2.</span>
                  <span>Solvabilitas excellent (EAR 50,57%, DER 97,7%)</span>
                </li>
                <li class="flex gap-2">
                  <span class="font-bold text-blue-600 flex-shrink-0">3.</span>
                  <span>Likuiditas aman (Quick Ratio 1,95)</span>
                </li>
                <li class="flex gap-2">
                  <span class="font-bold text-blue-600 flex-shrink-0">4.</span>
                  <span>Kemandirian finansial 100% bersumber dari anggota</span>
                </li>
              </ol>
            </div>

            <div class="hidden print:block mt-8 pt-4 border-t-2 border-gray-200">
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                <div>
                  <p class="text-xs text-gray-600 mb-8">Ketua Koperasi</p>
                  <div class="border-t-2 border-gray-800 pt-2 mx-4">
                    <p class="font-bold text-gray-800 text-sm">Mohamad Fatkhurrohman</p>
                  </div>
                </div>
                <div>
                  <p class="text-xs text-gray-600 mb-8">Bendahara</p>
                  <div class="border-t-2 border-gray-800 pt-2 mx-4">
                    <p class="font-bold text-gray-800 text-sm">Hasta Dwi Utami</p>
                  </div>
                </div>
                <div>
                  <p class="text-xs text-gray-600 mb-8">Anggota</p>
                  <div class="border-t-2 border-gray-800 pt-2 mx-4">
                    <p class="font-bold text-gray-800 text-sm">${member.nama}</p>
                  </div>
                </div>
              </div>
              <p class="text-center text-xs text-gray-500 mt-6">Dicetak pada: ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
            </div>
          </div>
        </div>
      `;

      detailContainer.classList.remove('hidden');
      detailContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function printPreview() {
      const element = document.querySelector('.print-section');
      if (!element) {
        showToast('Tidak ada data untuk dicetak', 'error');
        return;
      }
      
      const previewContainer = document.getElementById('print-preview-container');
      
      // Clone element
      const clonedElement = element.cloneNode(true);
      
      // Show all print-only elements in preview
      const printElements = clonedElement.querySelectorAll('.print\\:block');
      printElements.forEach(el => {
        el.style.display = 'block';
      });
      
      // Remove no-print elements
      const noPrintElements = clonedElement.querySelectorAll('.no-print');
      noPrintElements.forEach(el => {
        el.remove();
      });
      
      // Add print-specific styles
      clonedElement.style.width = '100%';
      clonedElement.style.maxWidth = '210mm';
      clonedElement.style.margin = '0 auto';
      clonedElement.style.padding = '15px';
      clonedElement.style.background = 'white';
      clonedElement.style.boxShadow = 'none';
      clonedElement.style.fontSize = '12px';
      
      previewContainer.innerHTML = '';
      previewContainer.appendChild(clonedElement);
      
      // Show modal
      document.getElementById('print-preview-modal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Scroll to top
      previewContainer.scrollTop = 0;
    }

    function closePrintPreview() {
      document.getElementById('print-preview-modal').classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function executePrint() {
      // Simple print function for mobile compatibility
      const printContent = document.getElementById('print-preview-container');
      
      if (!printContent) {
        showToast('Tidak ada konten untuk dicetak', 'error');
        return;
      }
      
      // Create a temporary iframe for printing
      const iframe = document.createElement('iframe');
      iframe.style.position = 'absolute';
      iframe.style.width = '0';
      iframe.style.height = '0';
      iframe.style.border = 'none';
      document.body.appendChild(iframe);
      
      // Get current date
      const now = new Date();
      const formattedDate = now.toLocaleDateString('id-ID', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      
      // Build print HTML
      const printHTML = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Laporan Anggota - ${config.organization_name || defaultConfig.organization_name}</title>
          <style>
            @page { size: A4; margin: 15mm; }
            body { 
              font-family: 'Inter', sans-serif; 
              line-height: 1.4; 
              color: #1f2937; 
              padding: 0; 
              margin: 0; 
              font-size: 12px;
            }
            .print-content { padding: 15px; }
            .header { text-align: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #059669; }
            .org-name { font-size: 18px; font-weight: 800; color: #0f172a; margin-bottom: 5px; }
            .report-title { font-size: 14px; font-weight: 600; color: #059669; margin-bottom: 5px; }
            .year-period { font-size: 12px; color: #6b7280; }
            .member-info { background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e5e7eb; }
            .member-name { font-size: 16px; font-weight: 700; color: #0f172a; margin-bottom: 5px; }
            .member-id { font-size: 12px; color: #6b7280; }
            .grid-4 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
            .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
            .card { padding: 10px; border-radius: 8px; border: 1px solid; }
            .card-title { font-size: 10px; font-weight: 600; margin-bottom: 5px; text-transform: uppercase; }
            .card-value { font-size: 14px; font-weight: 700; }
            .signature-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e5e7eb; }
            .signature-item { text-align: center; }
            .signature-title { font-size: 10px; color: #6b7280; margin-bottom: 30px; }
            .signature-line { border-top: 1px solid #1f2937; width: 80%; margin: 0 auto; padding-top: 5px; }
            .signature-name { font-weight: 700; color: #1f2937; font-size: 12px; }
            .footer { text-align: center; font-size: 10px; color: #6b7280; margin-top: 20px; padding-top: 10px; border-top: 1px dashed #d1d5db; }
          </style>
        </head>
        <body>
          <div class="print-content">
            ${printContent.innerHTML}
            <div class="footer">
              Dicetak pada: ${formattedDate}
            </div>
          </div>
          <script>
            window.onload = function() {
              setTimeout(function() {
                window.print();
                setTimeout(function() {
                  window.parent.document.body.removeChild(window.parent.document.querySelector('iframe'));
                }, 500);
              }, 300);
            };
          <\/script>
        </body>
        </html>
      `;
      
      const iframeDoc = iframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(printHTML);
      iframeDoc.close();
      
      // Show message
      showToast('Membuka dialog cetak...', 'info');
    }

    // Keyboard shortcuts for desktop
    document.addEventListener('keydown', function(e) {
      // Ctrl+P untuk print
      if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        const modal = document.getElementById('print-preview-modal');
        if (!modal.classList.contains('hidden')) {
          executePrint();
        }
      }
      
      // ESC untuk tutup preview
      if (e.key === 'Escape') {
        const modal = document.getElementById('print-preview-modal');
        if (!modal.classList.contains('hidden')) {
          closePrintPreview();
        }
      }
    });

    function closeModal() {
      document.getElementById('confirm-modal').classList.add('hidden');
    }

    // Toast notification
    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const colors = {
        success: 'bg-emerald-600',
        error: 'bg-red-600',
        warning: 'bg-amber-600',
        info: 'bg-blue-600'
      };

      const icons = {
        success: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
        error: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
        warning: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
        info: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
      };

      toast.className = `toast ${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg font-semibold text-sm flex items-center gap-2`;
      toast.innerHTML = `
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">${icons[type]}</svg>
        <span>${message}</span>
      `;
      
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function showLoading(text = 'Memproses...') {
      document.getElementById('loading-text').textContent = text;
      document.getElementById('loading-overlay').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loading-overlay').classList.add('hidden');
    }

    // Mobile touch events
    document.addEventListener('touchstart', function() {}, {passive: true});
    
    // Prevent zoom on double tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(event) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Start
    init();
    
    // Auto-refresh data every 5 minutes
    setInterval(fetchDataFromGoogleSheets, 5 * 60 * 1000);
  </script>
</body>
</html>
